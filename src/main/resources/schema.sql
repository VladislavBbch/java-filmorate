--DROP TABLE IF EXISTS USERS,FRIENDS, RATINGS, FILMS, LIKES, GENRES, FILMS_GENRES;
DROP TABLE IF EXISTS  LIKES, FRIENDS, FILMS_GENRES, USEFUL_REVIEWS, RATINGS, FILMS, USERS, GENRES, REVIEWS;

CREATE TABLE IF NOT EXISTS USERS
(
    ID       INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL    VARCHAR,
    LOGIN    VARCHAR,
    NAME     VARCHAR,
    BIRTHDAY DATE
);

CREATE TABLE IF NOT EXISTS FRIENDS
(
    USER_ID      INTEGER REFERENCES USERS (ID),
    FRIEND_ID    INTEGER REFERENCES USERS (ID),
    IS_CONFIRMED BOOLEAN,
    CONSTRAINT friends_pk PRIMARY KEY (USER_ID, FRIEND_ID)
);

CREATE TABLE IF NOT EXISTS RATINGS
(
    ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR
);

CREATE TABLE IF NOT EXISTS FILMS
(
    ID           INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME         VARCHAR,
    DESCRIPTION  VARCHAR(200),
    RELEASE_DATE DATE,
    DURATION     INTEGER,
    RATING_ID    INTEGER REFERENCES RATINGS (ID)
);

CREATE TABLE IF NOT EXISTS LIKES
(
    USER_ID INTEGER REFERENCES USERS (ID),
    FILM_ID INTEGER REFERENCES FILMS (ID),
    CONSTRAINT likes_pk PRIMARY KEY (USER_ID, FILM_ID)
);

CREATE TABLE IF NOT EXISTS GENRES
(
    ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR
);

CREATE TABLE IF NOT EXISTS FILMS_GENRES
(
    FILM_ID  INTEGER REFERENCES FILMS (ID),
    GENRE_ID INTEGER REFERENCES GENRES (ID),
    CONSTRAINT films_genres_pk PRIMARY KEY (FILM_ID, GENRE_ID)
);

CREATE TABLE IF NOT EXISTS REVIEWS
(
    ID       INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CONTENT  VARCHAR,
    FILM_ID  INTEGER REFERENCES FILMS (ID),
    USER_ID  INTEGER REFERENCES USERS (ID),
    IS_POSITIVE BOOLEAN,
    USEFUL   INTEGER
);

CREATE TABLE IF NOT EXISTS USEFUL_REVIEWS
(
    REVIEW_ID  INTEGER REFERENCES REVIEWS (ID),
    USER_ID INTEGER REFERENCES USERS (ID),
    IS_USEFUL BOOLEAN,
    CONSTRAINT reviews_pk PRIMARY KEY (REVIEW_ID, USER_ID)
);
